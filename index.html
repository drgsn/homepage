<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dev News Dashboard</title>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
    rel="stylesheet"
  />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap");
    body {
      font-family: "Inter", sans-serif;
      background-color: #030712;
    }
    .card {
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }
    .search-bar {
      transition: all 0.2s ease;
    }
    .search-bar:focus {
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }
    .loading-spinner {
      border-top-color: #3b82f6;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* Make sure the feed containers have a bigger fixed height and scroll */
    .feed-container {
      height: 40rem; 
      overflow-y: auto;
    }
  </style>
</head>

<body class="bg-gray-950 text-gray-200 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

    <!-- Search row: input + 2 buttons -->
    <div class="w-full flex gap-4 items-center mb-8">
      <input
        type="text"
        id="searchInput"
        placeholder="Search..."
        class="search-bar flex-1 px-4 py-2 bg-gray-900 border border-gray-800 rounded-lg text-gray-100 placeholder-gray-500 focus:outline-none"
      />
      <!-- Google Search button -->
      <button
        id="googleSearchBtn"
        class="px-4 py-2 bg-gray-900 hover:bg-gray-800 border border-gray-800 text-gray-300 rounded-lg transition-colors duration-200"
      >
        Google Search
      </button>
      <!-- Local Search button -->
      <button
        id="localSearchBtn"
        class="px-4 py-2 bg-gray-900 hover:bg-gray-800 border border-gray-800 text-gray-300 rounded-lg transition-colors duration-200"
      >
        Local Search
      </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- GitHub Trending -->
      <div class="card bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex justify-between items-start mb-6">
          <h2 class="text-lg font-medium text-white flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0012 2z"
              />
            </svg>
            <span>GitHub Trending</span>
          </h2>
          <button
            class="text-gray-400 hover:text-white transition-colors"
            onclick="toggleSettings('github')"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
              ></path>
            </svg>
          </button>
        </div>
        <div
          id="githubSettings"
          class="hidden mb-4 p-4 bg-gray-800/50 rounded-lg"
        >
          <div class="space-y-3">
            <div>
              <label class="block text-sm text-gray-400 mb-1">Language</label>
              <select
                id="githubLanguage"
                class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-gray-300"
              >
                <option value="">All Languages</option>
                <option value="javascript">JavaScript</option>
                <option value="python">Python</option>
                <option value="java">Java</option>
                <option value="typescript">TypeScript</option>
                <option value="go">Go</option>
                <option value="rust">Rust</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-1">Time Period</label>
              <select
                id="githubTimePeriod"
                class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-gray-300"
              >
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
          </div>
          <!-- Apply button -->
          <div class="mt-4">
            <button 
              class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors" 
              onclick="applyGitHubSettings()"
            >
              Apply
            </button>
          </div>
        </div>
        <!-- Feed container: fixed height + scrollable -->
        <div
          id="githubTrending"
          class="feed-container space-y-6"
        ></div>
      </div>

      <!-- Hacker News -->
      <div class="card bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex justify-between items-start mb-6">
          <h2 class="text-lg font-medium text-white flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"
              />
            </svg>
            <span>Hacker News</span>
          </h2>
          <button
            class="text-gray-400 hover:text-white transition-colors"
            onclick="toggleSettings('hackernews')"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
              ></path>
            </svg>
          </button>
        </div>
        <div
          id="hackernewsSettings"
          class="hidden mb-4 p-4 bg-gray-800/50 rounded-lg"
        >
          <div class="space-y-3">
            <div>
              <label class="block text-sm text-gray-400 mb-1">Story Type</label>
              <select
                id="hackerNewsType"
                class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-gray-300"
              >
                <option value="top">Top Stories</option>
                <option value="best">Best Stories</option>
                <option value="new">New Stories</option>
                <option value="show">Show HN</option>
                <option value="ask">Ask HN</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-1">Minimum Points</label>
              <input
                type="number"
                id="hackerNewsMinPoints"
                min="0"
                value="0"
                class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-gray-300"
              />
            </div>
          </div>
          <div class="mt-4">
            <button 
              class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors" 
              onclick="applyHackerNewsSettings()"
            >
              Apply
            </button>
          </div>
        </div>
        <!-- Feed container: fixed height + scrollable -->
        <div
          id="hackerNews"
          class="feed-container space-y-6"
        ></div>
      </div>

      <!-- Dev.to -->
      <div class="card bg-gray-900 rounded-xl p-6 border border-gray-800">
        <div class="flex justify-between items-start mb-6">
          <h2 class="text-lg font-medium text-white flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M7.42 10.05c-.18-.16-.46-.23-.84-.23H6l.02 2.44.04 2.45.56-.02c.41 0 .63-.07.83-.26.24-.24.26-.36.26-2.2 0-1.91-.02-1.96-.29-2.18zM0 4.94v14.12h24V4.94H0zM8.56 15.3c-.44.58-1.06.77-2.53.77H4.71V8.53h1.4c1.67 0 2.16.18 2.6.9.27.43.29.6.32 2.57.05 2.23-.02 2.73-.47 3.3zm5.09-5.47h-2.47v1.77h1.52v1.28l-.72.04-.75.03v1.77l1.22.03 1.2.04v1.28h-1.6c-1.53 0-1.6-.01-1.87-.3l-.3-.28v-3.16c0-3.02.01-3.18.25-3.48.23-.31.25-.31 1.88-.31h1.64v1.3zm4.68 5.45c-.17.43-.64.79-1.11.85-.86.11-1.39-.38-1.39-1.27 0-.9.62-1.41 1.74-1.41.39 0 .68.07.84.19v1.64zm.25-3.46c-.25-.2-.68-.27-.95-.27-.67 0-1.22.42-1.22.92 0 .51.58.88 1.77 1.13 1.76.36 2.31 1.04 2.31 2.52 0 .87-.53 1.72-1.32 2.08-.19.09-.69.16-1.11.16-.75 0-1.67-.25-2.22-.59l-.1-.05v-1.22l.97.39c.57.23 1.07.35 1.35.35.72 0 1.06-.23 1.06-.72 0-.58-.58-.9-1.86-1.22-1.49-.36-2.23-1.21-2.23-2.52 0-1.79 1.26-2.71 3.06-2.71 1.02 0 1.76.19 2.24.39v1.37l-.75-.29z"
              />
            </svg>
            <span>Dev.to</span>
          </h2>
          <button
            class="text-gray-400 hover:text-white transition-colors"
            onclick="toggleSettings('devto')"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"
              ></path>
            </svg>
          </button>
        </div>
        <div
          id="devtoSettings"
          class="hidden mb-4 p-4 bg-gray-800/50 rounded-lg"
        >
          <div class="space-y-3">
            <div>
              <label class="block text-sm text-gray-400 mb-1">Tag</label>
              <select
                id="devToTag"
                class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-gray-300"
              >
                <option value="">All Tags</option>
                <option value="javascript">JavaScript</option>
                <option value="webdev">Web Dev</option>
                <option value="programming">Programming</option>
                <option value="python">Python</option>
                <option value="react">React</option>
              </select>
            </div>
            <div>
              <label class="block text-sm text-gray-400 mb-1">Sort By</label>
              <select
                id="devToSort"
                class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-sm text-gray-300"
              >
                <option value="recent">Recent</option>
                <option value="rising">Rising</option>
                <option value="relevant">Relevant</option>
              </select>
            </div>
          </div>
          <div class="mt-4">
            <button 
              class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors" 
              onclick="applyDevToSettings()"
            >
              Apply
            </button>
          </div>
        </div>
        <!-- Feed container: fixed height + scrollable -->
        <div
          id="devTo"
          class="feed-container space-y-6"
        ></div>
      </div>
    </div>
  </div>

  <script>
    // --- Settings management ---
    const defaultSettings = {
      github: {
        language: "",
        timePeriod: "daily",
      },
      hackernews: {
        type: "top",
        minPoints: 0,
      },
      devto: {
        tag: "",
        sort: "recent",
      },
    };

    let settings = JSON.parse(localStorage.getItem("devNewsDashboardSettings")) || defaultSettings;

    function saveSettings() {
      localStorage.setItem("devNewsDashboardSettings", JSON.stringify(settings));
    }

    function loadSettings() {
      // Load GitHub settings
      document.getElementById("githubLanguage").value = settings.github.language;
      document.getElementById("githubTimePeriod").value = settings.github.timePeriod;

      // Load HackerNews settings
      document.getElementById("hackerNewsType").value = settings.hackernews.type;
      document.getElementById("hackerNewsMinPoints").value = settings.hackernews.minPoints;

      // Load Dev.to settings
      document.getElementById("devToTag").value = settings.devto.tag;
      document.getElementById("devToSort").value = settings.devto.sort;
    }

    // --- Apply buttons for each feed ---

    function applyGitHubSettings() {
      // Take current input values from selects and store them in settings
      settings.github.language = document.getElementById("githubLanguage").value;
      settings.github.timePeriod = document.getElementById("githubTimePeriod").value;
      // Save to localStorage
      saveSettings();
      // Hide settings panel
      document.getElementById("githubSettings").classList.add("hidden");
      // Scroll top
      document.getElementById("githubTrending").scrollTop = 0;
      // Refresh feed
      resetGitHub();
    }

    function applyHackerNewsSettings() {
      settings.hackernews.type = document.getElementById("hackerNewsType").value;
      settings.hackernews.minPoints = parseInt(document.getElementById("hackerNewsMinPoints").value, 10) || 0;
      saveSettings();
      document.getElementById("hackernewsSettings").classList.add("hidden");
      document.getElementById("hackerNews").scrollTop = 0;
      resetHackerNews();
    }

    function applyDevToSettings() {
      settings.devto.tag = document.getElementById("devToTag").value;
      settings.devto.sort = document.getElementById("devToSort").value;
      saveSettings();
      document.getElementById("devtoSettings").classList.add("hidden");
      document.getElementById("devTo").scrollTop = 0;
      resetDevTo();
    }

    function toggleSettings(section) {
      const settingsId = `${section}Settings`;
      const settingsDiv = document.getElementById(settingsId);
      const allSettings = document.querySelectorAll('[id$="Settings"]');

      allSettings.forEach((div) => {
        if (div.id !== settingsId) {
          div.classList.add("hidden");
        }
      });

      settingsDiv.classList.toggle("hidden");
    }

    // --- Global variables for pagination / infinite scroll ---
    let githubPage = 1;
    let githubIsLoading = false;
    let hackerNewsIDs = []; // store all story IDs for the selected type
    let hackerNewsIndex = 0; // track how many we've loaded so far
    let hackerNewsIsLoading = false;
    let devToPage = 1;
    let devToIsLoading = false;

    // --- GitHub Trending Pagination ---
    async function fetchGitHubTrending() {
      if (githubIsLoading) return;
      githubIsLoading = true;

      // Build date/time-based query
      let query = "created:>";
      switch (settings.github.timePeriod) {
        case "daily":
          query += new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString().split("T")[0];
          break;
        case "weekly":
          query += new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split("T")[0];
          break;
        case "monthly":
          query += new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split("T")[0];
          break;
      }
      if (settings.github.language) {
        query += `+language:${settings.github.language}`;
      }

      // Use &page=... to get next set
      const url = `https://api.github.com/search/repositories?q=${query}&sort=stars&order=desc&page=${githubPage}&per_page=20`;
      const response = await fetch(url);
      const data = await response.json();
      const trending = data.items || [];

      const container = document.getElementById("githubTrending");
      // If first page, clear container so we don't stack "loading" or previous articles
      if (githubPage === 1) {
        container.innerHTML = "";
      }

      container.innerHTML += trending
        .map(
          (repo) => `
            <div class="fade-in border-b border-gray-800 pb-4 group hover:bg-gray-800/50 -mx-6 px-6 transition-colors duration-200">
              <a
                href="${repo.html_url}"
                target="_blank"
                rel="noopener"
                class="text-blue-400 hover:text-blue-300 font-medium block mb-2 group-hover:underline"
              >
                ${repo.full_name}
              </a>
              <p class="text-gray-400 text-sm mb-3">${repo.description || ""}</p>
              <div class="flex items-center gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"
                    />
                  </svg>
                  ${repo.stargazers_count.toLocaleString()}
                </span>
                <span class="flex items-center gap-1">
                  <span class="w-2 h-2 rounded-full" style="background-color: ${
                    repo.language ? "#3b82f6" : "#6b7280"
                  }"></span>
                  ${repo.language || "Various"}
                </span>
              </div>
            </div>
          `
        )
        .join("");

      githubPage++;
      githubIsLoading = false;
    }

    // Reset GitHub (clear container, reset page, then fetch)
    function resetGitHub() {
      githubPage = 1;
      document.getElementById("githubTrending").innerHTML = loadingSpinner();
      fetchGitHubTrending();
    }

    // --- Hacker News Infinite-like scroll (in 20-story chunks) ---
    async function fetchHackerNewsIDs() {
      const storyType = settings.hackernews.type;
      const response = await fetch(`https://hacker-news.firebaseio.com/v0/${storyType}stories.json`);
      hackerNewsIDs = await response.json();
    }

    async function fetchHackerNewsChunk() {
      if (hackerNewsIsLoading) return;
      hackerNewsIsLoading = true;
      const container = document.getElementById("hackerNews");

      // If starting fresh, remove placeholder
      if (hackerNewsIndex === 0) {
        container.innerHTML = "";
      }

      // Get next 20 IDs
      const slice = hackerNewsIDs.slice(hackerNewsIndex, hackerNewsIndex + 20);
      const stories = await Promise.all(
        slice.map(async (id) => {
          const storyResponse = await fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`);
          return storyResponse.json();
        })
      );

      // Filter stories based on minPoints
      const filteredStories = stories.filter((story) => story && story.score >= settings.hackernews.minPoints);

      const html = filteredStories
        .map(
          (story) => `
            <div class="fade-in border-b border-gray-800 pb-4 group hover:bg-gray-800/50 -mx-6 px-6 transition-colors duration-200">
              <a
                href="${story.url}"
                target="_blank"
                rel="noopener"
                class="text-blue-400 hover:text-blue-300 font-medium block mb-2 group-hover:underline"
              >
                ${story.title}
              </a>
              <div class="flex items-center gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3c3.08 0 5.5 2.42 5.5 5.5 0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                    />
                  </svg>
                  ${story.score}
                </span>
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                    />
                  </svg>
                  ${story.descendants || 0}
                </span>
              </div>
            </div>
          `
        )
        .join("");

      container.innerHTML += html;
      hackerNewsIndex += 20;
      hackerNewsIsLoading = false;
    }

    function resetHackerNews() {
      const container = document.getElementById("hackerNews");
      container.innerHTML = loadingSpinner();
      hackerNewsIndex = 0;
      fetchHackerNewsIDs().then(() => {
        // after IDs are fetched, start loading articles
        fetchHackerNewsChunk();
      });
    }

    // --- Dev.to Pagination ---
    async function fetchDevTo() {
      if (devToIsLoading) return;
      devToIsLoading = true;

      let url = `https://dev.to/api/articles?per_page=20&page=${devToPage}`;
      if (settings.devto.tag) {
        url += `&tag=${settings.devto.tag}`;
      }

      // We'll approximate "rising" or "relevant" by using top param
      switch (settings.devto.sort) {
        case "rising":
          url += "&top=7"; // top articles from last 7 days
          break;
        case "relevant":
          url += "&top=30"; // top articles from last 30 days
          break;
        // 'recent' is the default
      }

      const response = await fetch(url);
      const articles = await response.json();

      const container = document.getElementById("devTo");
      // If first page, clear container so we don't stack "loading" or old items
      if (devToPage === 1) {
        container.innerHTML = "";
      }

      container.innerHTML += articles
        .map(
          (article) => `
            <div class="fade-in border-b border-gray-800 pb-4 group hover:bg-gray-800/50 -mx-6 px-6 transition-colors duration-200">
              <a
                href="${article.url}"
                target="_blank"
                rel="noopener"
                class="text-blue-400 hover:text-blue-300 font-medium block mb-2 group-hover:underline"
              >
                ${article.title}
              </a>
              <p class="text-gray-400 text-sm mb-3">${article.description || ""}</p>
              <div class="flex items-center gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                    />
                  </svg>
                  ${article.positive_reactions_count}
                </span>
                <div class="flex items-center gap-2">
                  ${
                    article.tags
                      ? article.tags
                          .split(",")
                          .slice(0, 2)
                          .map(
                            (tag) =>
                              `<span class="px-2 py-0.5 rounded-full text-xs bg-gray-800 text-gray-400">${tag.trim()}</span>`
                          )
                          .join("")
                      : ""
                  }
                </div>
              </div>
            </div>
          `
        )
        .join("");

      devToPage++;
      devToIsLoading = false;
    }

    function resetDevTo() {
      devToPage = 1;
      const container = document.getElementById("devTo");
      container.innerHTML = loadingSpinner();
      fetchDevTo();
    }

    // --- Scroll Listeners for infinite scroll ---
    document.getElementById("githubTrending").addEventListener("scroll", function (e) {
      const el = e.target;
      if (el.scrollTop + el.clientHeight >= el.scrollHeight - 10) {
        fetchGitHubTrending();
      }
    });

    document.getElementById("hackerNews").addEventListener("scroll", function (e) {
      const el = e.target;
      if (el.scrollTop + el.clientHeight >= el.scrollHeight - 10) {
        fetchHackerNewsChunk();
      }
    });

    document.getElementById("devTo").addEventListener("scroll", function (e) {
      const el = e.target;
      if (el.scrollTop + el.clientHeight >= el.scrollHeight - 10) {
        fetchDevTo();
      }
    });

    // --- Reusable loading spinner markup ---
    function loadingSpinner() {
      return `
        <div class="flex items-center justify-center h-32">
          <div
            class="loading-spinner w-6 h-6 border-2 border-gray-800 border-t-blue-500 rounded-full"
          ></div>
        </div>`;
    }

    // --- Initialize / refresh all feeds ---
    function refreshFeeds() {
      resetGitHub();
      resetHackerNews();
      resetDevTo();
    }

    // --- Searching: Enter => Google, Shift+Enter => local ---
    document.getElementById("searchInput").addEventListener("keydown", function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
        // Normal Enter => Google
        e.preventDefault();
        const term = e.target.value.trim();
        if (!term) return;
        window.open("https://www.google.com/search?q=" + encodeURIComponent(term), "_blank");
      } else if (e.key === "Enter" && e.shiftKey) {
        // Shift+Enter => local search
        e.preventDefault();
        const term = e.target.value.trim().toLowerCase();
        if (!term) return;
        doLocalSearch(term);
      }
    });

    // --- If user clicks the "Google Search" button ---
    document.getElementById("googleSearchBtn").addEventListener("click", function () {
      const term = document.getElementById("searchInput").value.trim();
      if (!term) return;
      window.open("https://www.google.com/search?q=" + encodeURIComponent(term), "_blank");
    });

    // --- If user clicks the "Local Search" button ---
    document.getElementById("localSearchBtn").addEventListener("click", function () {
      const term = document.getElementById("searchInput").value.trim().toLowerCase();
      if (!term) return;
      doLocalSearch(term);
    });

    // --- Local search: hide items that don’t match text ---
    function doLocalSearch(searchTerm) {
      const allCards = document.querySelectorAll(".feed-container > div");
      allCards.forEach((item) => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(searchTerm) ? "block" : "none";
      });
    }

    // --- Error handling with subtle notification ---
    window.onerror = function (msg, url, lineNo, columnNo, error) {
      console.error("Error: ", msg, "URL: ", url, "Line: ", lineNo, "Column: ", columnNo, "Error object: ", error);
      return false;
    };

    // --- On load, set settings, refresh feeds, then auto refresh every 5 minutes ---
    loadSettings();
    refreshFeeds();
    setInterval(refreshFeeds, 300000);
  </script>
</body>
</html>
